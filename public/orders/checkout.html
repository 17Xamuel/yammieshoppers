<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="../resources/cartlink.png" />
    <link rel="stylesheet" href="../styles/main.css" />
    <link rel="stylesheet" href="../font-awesome/css/all.css" />
    <title>Yammie | checkout - complete your order</title>
    <style>
      .-disabled {
        pointer-events: none;
        opacity: 0.4;
      }
      .search-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 70vw;
        margin: 0px auto;
      }
      .nav {
        z-index: 20;
        box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0px;
        background-color: #fff;
      }
      .order-f {
        font-size: 24px;
      }
      .p-order-ctr {
        width: 70vw;
        margin: 20px auto;
      }
      .p-order-progress {
        height: 7px;
        width: 100%;
        background-color: rgba(0, 0, 0, 0.3);
        margin: 20px 0px;
        border-radius: 50px;
      }
      .p-order-progress-b {
        height: 7px;
        width: 100%;
        background-color: #ffbb00;
        border-radius: 40px;
        transition: all 0.5s ease-in-out;
      }
    </style>
    <style>
      .-order-ctr {
        display: flex;
        justify-content: space-between;
      }
      .-steps {
        width: 65%;
      }
      .-order {
        width: 34%;
      }
      .p-order-s-1 {
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 3px 3px 6px #cfcfcf;
        padding: 5px 0px;
        margin: 10px 0px;
        height: fit-content;
      }
      .s-1-head {
        display: flex;
        justify-content: space-between;
        padding: 5px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.2);
      }
      .s-1-head > span > .fas {
        padding-right: 10px;
        font-size: 22px;
      }
      .-s-i-1 {
        color: green;
      }
      ._ca {
        border: 1px solid rgb(0, 0, 0, 0.1);
        margin: 15px;
        border-radius: 5px;
      }
      ._cad {
        margin: 5px 20px;
      }
      ._ca-btn {
        width: 60%;
        margin: 15px;
        padding: 8px 0px;
        font-size: 16px;
        box-shadow: 3px 3px 5px #e2e2e2;
        border-radius: 30px;
        border: none;
        outline: none;
        color: white;
        background-color: #ffbb00;
        cursor: pointer;
      }
      ._ca-btn:hover {
        opacity: 0.6;
      }
      /*delivery method*/
      .deliver {
        padding: 10px 20px;
      }
      .-d-method {
        margin-left: 3%;
      }
      .p-order-residence {
        margin-left: 6%;
      }
      .p-order-name {
        margin-top: 3%;
      }

      .order-f {
        font-size: 24px;
      }
      .-dm-e,
      .-pm {
        color: red;
        opacity: 0;
        transition: all 0.3s ease-in-out;
      }
      .na {
        color: red;
        display: none;
      }
      .p-order-procedure {
        margin: 10px 5px;
      }
      .p-order-procedure > ol {
        margin-left: 25px;
      }
    </style>
    <style>
      .s-1-head > span > .fas {
        padding-right: 10px;
        font-size: 22px;
      }
      .-s-i-1 {
        color: green;
      }
      .p-order-address {
        padding: 5px 0px 5px 35px;
      }
      .edit {
        color: #ffbb00;
        cursor: pointer;
      }
      #pay-form {
        margin-top: 10px;
      }
      .mm-input {
        display: flex;
        align-items: center;
      }
      .-mm-l {
        margin-left: 5%;
      }
      .-mm-img {
        margin-left: 7%;
      }
      .p-order-procedure {
        margin: 10px 5px;
      }
      .p-order-procedure > ol {
        margin-left: 25px;
      }
      .cd-image {
        margin: 5px;
        padding-left: 3%;
      }
      .am-t-p {
        margin-right: 25px;
      }
      .-am {
        display: flex;
        width: 100%;
        padding-right: 5px;
        justify-content: space-between;
        margin-right: 5px;
      }
      .total {
        border-top: 1px solid rgba(0, 0, 0, 0.1);
      }
      .-btn-s-pyf {
        width: 95%;
        margin: 15px auto;
        padding: 10px 0px;
        font-size: 17px;
        box-shadow: 3px 3px 5px #e2e2e2;
        border-radius: 30px;
        border: none;
        outline: none;
        color: white;
        background-color: #ffbb00;
        cursor: pointer;
      }
      .-btn-a-d {
        width: 60%;
        margin: 15px auto;
        padding: 8px 0px;
        font-size: 16px;
        box-shadow: 3px 3px 5px #e2e2e2;
        border-radius: 30px;
        border: none;
        outline: none;
        color: white;
        background-color: #ffbb00;
        cursor: pointer;
      }
      .edit-a-ctr.active {
        display: none;
      }
      #residence {
        width: 85%;
        border: 1px solid rgb(0, 0, 0, 0.2);
        border-radius: 5px;
        height: 30px;
        outline: none;
        font-size: 17px;
        margin-top: 5%;
      }
      ._add {
        width: 85%;
        border: 1px solid rgb(0, 0, 0, 0.2);
        border-radius: 5px;
        height: 30px;
        outline: none;
        font-size: 17px;
        margin-top: 5%;
      }
      #-edit-a {
        margin: 2% 7%;
        padding: 2%;
        border: 1px solid rgb(0, 0, 0, 0.2);
        border-radius: 10px;
      }
      #other {
        border: 0;
        outline: none;
        width: 70%;
        border-bottom: 1px solid rgb(0, 0, 0, 0.3);
        margin-top: 5px;
        font-size: 17px;
        padding: 5px;
      }
      #or {
        margin-top: 2%;
        display: flex;
        justify-content: space-around;
      }
      .-edit-p {
        margin: 2% 7%;
        width: 85%;
        padding: 10px 5px;
        font-size: 17px;
        border: none;
        outline: none;
        background-color: #ffbb00;
        color: white;
        border-radius: 5px;
        box-shadow: 2px 2px 5px #c3c3c3;
        transform: translateY(-4px);
        cursor: pointer;
        transition: all 0.3s ease-in-out;
      }
      /*delivery method*/
      .-d-method {
        margin-left: 2%;
      }
      .p-order-residence {
        margin-left: 4%;
      }
      .-d-u {
        margin-left: 1%;
      }
      .p-order-name {
        margin-top: 2%;
      }

      .order-f {
        font-size: 24px;
      }
      .-dm-e,
      .-pm {
        color: red;
        opacity: 0;
        transition: all 0.3s ease-in-out;
      }
      .na {
        color: red;
        display: none;
      }
      ._check-item {
        border-top: 1px solid rgb(0, 0, 0, 0.1);
        border-bottom: 1px solid rgb(0, 0, 0, 0.1);
        display: flex;
        margin: 5px;
        padding: 5px;
      }
      ._check-item > .img {
        width: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      ._check-item > .img > div {
        background-color: rgba(0, 0, 0, 0.1);
        width: 85px;
        height: 85px;
      }
      .-item {
        height: fit-content;
      }
      .-item > div {
        padding-top: 5px;
      }
      .-st > .-st-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 10px 0px;
        font-size: 15px;
      }
      .totals {
        margin: 5px;
        padding: 5px;
      }
      .-o-total {
        padding: 10px 0px;
        font-weight: bold;
        border-top: 1px solid rgb(0, 0, 0, 0.1);
        border-bottom: 1px solid rgb(0, 0, 0, 0.1);
      }
      .show_order {
        display: none;
      }
      .-ony-ldr {
        text-align: center;
        font-size: 24px;
        padding: 10px 0px;
        color: green;
      }
      .-ony-ldr > i {
        display: none;
      }
      @media screen and (max-width: 768px) {
        .nav {
          height: 8vh;
          display: flex;
          align-items: center;
        }
        .order-f {
          display: none;
        }
        .p-order-ctr {
          width: 90vw;
          margin: 20px auto;
        }
        .-order-ctr {
          flex-direction: column-reverse;
        }
        .-order-ctr > div {
          width: 100%;
        }
        .-od-ctr {
          display: none;
        }
        .-od-ctr.active {
          display: block;
        }
        .show_order {
          display: block;
          opacity: 1;
        }
        .show_order:hover {
          opacity: 1;
        }
      }
    </style>
    <script>
      if (document.referrer == "") {
        self.location = "/";
      }
    </script>
  </head>
  <body>
    <div class="nav">
      <div class="search-nav">
        <div class="logo">
          <img
            src="../resources/yammie.png"
            alt="YAMMIE"
            width="200"
            height="95%"
            id="logo"
          />
        </div>
        <div class="order-f">
          <b>Process Your Order: </b>
        </div>
        <div class="-account -user focus">
          <a
            href="../404"
            style="margin-right: 20px"
            onmouseover="this.style.color = '#ffbb00'"
            onmouseout="this.style.color='#000'"
          >
            <i class="far fa-question-circle"></i>
            Help Center
          </a>
          <a
            href="../404"
            onmouseover="this.style.color = '#ffbb00'"
            onmouseout="this.style.color='#000'"
          >
            <i class="fas fa-phone-volume"></i>
            Call Us
          </a>
        </div>
      </div>
    </div>
    <div class="p-order-m-ctr">
      <div class="p-order-ctr">
        <h3 class="current-s">Order CheckOut</h3>
        <div class="p-order-progress">
          <div class="p-order-progress-b"></div>
        </div>
        <div class="-order-ctr">
          <div class="-steps">
            <div class="p-order-s-1">
              <div class="s-1-head">
                <span>
                  <i class="fas fa-check-circle -s-i-1"></i>
                  <b>Your Current Address</b>
                </span>
                <b class="edit edit-a-b">Edit</b>
              </div>
              <div class="_ca">
                <b
                  ><div class="_cn _cad _cn">
                    <i class="fas fa-spinner fa-spin"></i></div
                ></b>
                <div class="_cr _cad _1a"></div>
                <div class="_cz _cad _cmz"></div>
                <div class="_cz _cad _cmn"></div>
              </div>
              <form class="_ca _dn _ea" style="display: none">
                <div class="_cad">
                  <h4 style="margin: 10px 0px">Add/Change Your Address</h4>
                  <label for="">Type</label>
                  <br />
                  <select
                    name=""
                    id="type"
                    required
                    class="-is type"
                    style="width: 250px"
                  >
                    <option value="" hidden>Select Type</option>
                    <option value="Primary">Primary Address</option>
                    <option value="guest">Guest Address</option>
                  </select>
                  <div style="color: red; display: none" class="_guest">
                    Guest Addresses are just temporary
                  </div>
                </div>
                <div class="_cad">
                  <label for="">Location/Residence</label>
                  <br />
                  <select
                    name=""
                    id="location"
                    class="-is ca"
                    style="width: 250px"
                  >
                    <option value="" hidden>Select Your Residence</option>
                    <option value="Management">Management Sciences</option>
                    <option value="Hospital">Hospital</option>
                    <option value="Education">Education</option>
                    <option value="keturah">keturah</option>
                    <option value="Wilson">Wilson</option>
                    <option value="Royal">Royal</option>
                    <option value="Cosima">Cosima</option>
                    <option value="Abraham">Abraham</option>
                    <option value="Bako">Bako</option>
                    <option value="Naphtali">Naphtali</option>
                    <option value="God's Mercy">God's Mercy</option>
                    <option value="Masengere">
                      Masengere(These Funny Rentals)
                    </option>
                    <option value="Black Roof">Black Roof</option>
                    <option value="Pioneer">Pioneer</option>
                    <option value="Pilipo">Pilipo</option>
                    <option value="Gloryianta">Gloryianta</option>
                    <option value="Mandela">Mandela</option>
                    <option value="Washington">Washington</option>
                    <option value="St. Peters(Flat)">St. Peters(Flat)</option>
                    <option value="St. Peters">St. Peters</option>
                    <option value="Northern Elite">Northern Elite</option>
                    <option value="Jeremiah">Jeremiah</option>
                  </select>
                </div>
                <div class="_cad">
                  <label for="">Your Zone</label>
                  <br />
                  <input
                    placeholder="Zone"
                    type="text"
                    name=""
                    id="zone"
                    class="-is cz"
                    style="width: 250px"
                    readonly
                  />
                </div>
                <div class="_cad">
                  <label for="other-a">Other:</label>
                  <input
                    type="text"
                    name=""
                    id="other"
                    placeholder="(Specify)"
                  />
                </div>
                <button class="_ca-btn">Ok</button>
              </form>
            </div>
            <div class="p-order-s-1">
              <div class="s-1-head">
                <span>
                  <i class="fas fa-check-circle -s-i-2"></i>
                  <b>Delivery Method</b>
                </span>
                <span class="-edit-d edit"> Edit </span>
              </div>
              <div
                class="_ca _dm-r p-order-address deliver"
                style="display: none"
              ></div>
              <form class="p-order-address deliver _ca _dm" id="-df">
                <b>Select Your Preferred Delivery Method</b>
                <div class="p-order-name">
                  <input
                    required
                    type="radio"
                    name="d-method"
                    id="-d1"
                    value="Door-Step"
                  /><b class="-d-method">Door Step Delivery</b>
                </div>
                <div class="p-order-residence">We Reach At Your Residence.</div>
                <div class="p-order-residence">
                  Delivered By: <span class="d-fees">Yammie Delivery</span>
                </div>
                <div class="p-order-name">
                  <input
                    required
                    type="radio"
                    name="d-method"
                    id="-d2"
                    value="Pick-Up"
                  /><b class="-d-method">Free Pick Up</b>
                </div>
                <div class="p-order-residence">
                  Get your items at the Yammie Store
                </div>
                <div class="p-order-residence">
                  Location:
                  <span class="d-fees">Next to Yammie SuperMarket</span>
                </div>
                <div class="_u">
                  <b>Is your Order Urgent</b>
                  <div class="p-order-name">
                    <input type="checkbox" name="d-u" id="-ug" value="-u" />
                    <span class="-d-u">Yes</span>
                  </div>
                </div>
                <button class="_ca-btn" type="submit">Proceed</button>
              </form>
            </div>
            <div class="p-order-s-1">
              <div class="s-1-head">
                <span>
                  <i class="fas fa-check-circle -s-i-3"></i>
                  <b>Payment Details</b>
                </span>
              </div>
              <div class="p-order-address payment _ca" style="display: none">
                <div class="p-order-name">
                  <b>Select Your Preferred Payment Method</b>
                </div>
                <form id="pay-form" class="_pf">
                  <div class="mm-input -disabled">
                    <input
                      required
                      type="radio"
                      name="payment_method"
                      id="payment_method_mm"
                      value="mm"
                    />
                    <label for="payment_method" class="-mm-l -disabled">
                      <b>Mobile Money</b> - MTN (Disabled for a moment...)
                    </label>
                  </div>
                  <div class="-mm-img -disabled">
                    <img src="../resources/mtn-mm.png" alt="" />
                  </div>
                  <div class="p-order-procedure -disabled">
                    <b>Mobile Money Payment Procedure:</b>
                    <ol>
                      <li>Click 'Finish Your Order'</li>
                      <li>Fill In Details On The Next Page</li>
                      <li>Click 'Pay Now'</li>
                      <li>Check your phone for payment request</li>
                      <li>Enter your PIN And Approve</li>
                      <li>
                        You will receive SMS/Email confirming a successful
                        payment.
                      </li>
                    </ol>
                  </div>
                  <div class="mm-input">
                    <input
                      required
                      type="radio"
                      name="payment_method"
                      id="payment_method"
                      value="cod"
                    />
                    <span class="cd-image">
                      <img src="../resources/cash-on-delivery.png" alt="" />
                    </span>
                    <label for="payment_method">
                      <b>Cash On Delivery.</b>
                    </label>
                  </div>
                  <div class="am-t-p">
                    <div class="sub-total -am">
                      <span>SUB. TOTAL</span>
                      <span
                        ><b>UGX <span id="pay">...</span></b></span
                      >
                    </div>
                    <div class="-delivery-fees -am">
                      <span><b>Delivery Fees</b></span>
                      <span>UGX <span id="delivery">...</span></span>
                    </div>
                    <div class="total -am">
                      <span><b>TOTAL</b></span>
                      <span
                        ><b>UGX <span id="total">...</span></b></span
                      >
                    </div>
                  </div>
                  <div class="-ony-ldr">
                    <i class="fas fa-spinner fa-spin"></i>
                  </div>
                  <button type="submit" class="-btn-s-pyf">
                    FINISH YOUR ORDER
                  </button>
                </form>
              </div>
            </div>
          </div>
          <div class="-order">
            <div class="p-order-s-1">
              <div class="s-1-head">
                <span>
                  <i class="fas fa-box -s-i-1"></i>
                  <b>Your Order Details</b>
                </span>
              </div>
              <button class="show_order _ca-btn">Show Order Details</button>
              <div class="-od-ctr">
                <div class="items">No items</div>
                <div class="totals">
                  <div class="sub-total -st">
                    <div class="-st-content">
                      <span>Sub. Total</span>
                      <span class="_total">UGX ...</span>
                    </div>
                  </div>
                  <div class="-st-delivery -st">
                    <div class="-st-content">
                      <span>Total Shipping Fees</span>
                      <span class="_shp">UGX ...</span>
                    </div>
                  </div>
                  <div class="-st-totals -st">
                    <div class="-st-content -o-total">
                      <span>Total</span>
                      <span class=""><span class="_ony-tt">UGX ...</span></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--scripts-->
    <script>
      //static
      let numberFormat = new Intl.NumberFormat();
      let totalPrice = 0;
      let product = {};
      product.qty = 0;
      let _upa = true;
      let _add = {};
      let _dm = {};
      let _ony = {};
      let yammie = localStorage.getItem(
        "https://yammieshoppers.com/useLocalStorage/Storage"
      );
      displayCart();
      let cartItems = localStorage.getItem("cartItems");
      function displayCart() {
        let cartItems = JSON.parse(localStorage.getItem("cartItems"));
        let cartDom = document.querySelector(".items");
        cartDom.innerHTML = "";
        async function itemCollect(i) {
          let res = await fetch(`/api/user/product/${i}`);
          let item = await res.json();
          return item;
        }
        Object.values(cartItems).forEach(async (key) => {
          //dom
          let item = await itemCollect(key.cartItemAdded);
          //dom
          cartDom.innerHTML += `
            <div class="_check-item">
                    <div class="img">
                      <div class="">
                      <img
                        src="${JSON.parse(item.images)[0]}"
                        alt=""
                        width="100%"
                        height="100%"
                      />
                      </div>
                    </div>
                    <div class="-item">
                      <div class="name" style="overflow: hidden">
                        ${item.product}
                      </div>
                      <div class="price _usp">Price: UGX
                        <span class="item_price">${numberFormat.format(
                          item.discount
                            ? (item.price * (100 - item.discount)) / 100
                            : item.price
                        )}</span>
                      </div>
                      <div class="qty _usq">Quantity: ${key.inCartNumber}</div>
                    </div>
                  </div>
            `;
        });
      }
    </script>
    <script>
      function _ca(i, z) {
        i.addEventListener("change", (e) => {
          z.value =
            i.value == "keturah" || i.value == "Wilson"
              ? "Keturah Zone"
              : i.value == "Royal" ||
                i.value == "Cosima" ||
                i.value == "Maroon" ||
                i.value == "Abraham"
              ? "Royal Zone"
              : i.value == "Maisha" ||
                i.value == "Bako" ||
                i.value == "Naphtali" ||
                i.value == "Masengere" ||
                i.value == "God's Mercy"
              ? "Maisha Zone"
              : i.value == "Gloryianta" ||
                i.value == "Mandela" ||
                i.value == "Pilipo" ||
                i.value == "Pioneer" ||
                i.value == "Black Roof"
              ? "Pioneer Zone"
              : i.value == "Washington"
              ? "Washington Zone"
              : i.value == "St. Peters(Flat)"
              ? "St. Peters Zone"
              : i.value == "Pacuwa" ||
                i.value == "St. Peters" ||
                i.value == "Genesis"
              ? "Pacuwa Zone"
              : i.value == "Northern Elite"
              ? "Northern Elite Zone"
              : i.value == "Jeremiah"
              ? "Jeremiah Zone"
              : i.value == "Hospital"
              ? "Hospital Side"
              : i.value == "Management"
              ? "Management Sciences"
              : i.value == "Education"
              ? "Education Block"
              : "Other";
        });
      }
      document.querySelector(".type").addEventListener("change", () => {
        document.querySelector("._guest").style.display =
          document.querySelector(".type").value == "guest" ? "block" : "none";
      });
      document.querySelector(".edit-a-b").addEventListener("click", () => {
        document.querySelector("._dn").style.display =
          document.querySelector("._dn").style.display == "none"
            ? "block"
            : "none";
      });
      document.querySelector(".-edit-d").addEventListener("click", () => {
        document.querySelector("._dm").style.display =
          document.querySelector("._dm").style.display == "none"
            ? "block"
            : "none";
      });
      _ca(document.querySelector(".ca"), document.querySelector(".cz"));
    </script>
    <script>
      document.querySelector("._ea").addEventListener("submit", (e) => {
        e.preventDefault();
        _add.type = document.querySelector("#type").value || "Primary";
        _add.add =
          document.querySelector("#location").value ||
          document.querySelector("#other").value;
        _add.zone = document.querySelector("#zone").value || "No Zone";
        _upa = _add.type == "guest" ? false : true;
        if (_upa == true) {
          if (localStorage.getItem("_upa")) localStorage.clear("_upa");
          xhr = new XMLHttpRequest();
          xhr.onreadystatechange = () => {
            if (xhr.readyState == 4 && xhr.status == 200) {
              if (xhr.responseText == "Changed") {
                window.location.reload();
              }
            }
          };
          xhr.open("POST", `/api/user/account/address/edit/${yammie}`, true);
          xhr.setRequestHeader("Content-type", "application/json");
          xhr.send(JSON.stringify(_add));
        } else {
          document.querySelector("._cr").innerHTML = _add.add;
          document.querySelector("._cz").innerHTML = _add.zone;
          document.querySelector("._ea").style.display = "none";
          localStorage.setItem("_upa", _add.zone);
        }
      });
      //address
      function _ua(url) {
        let xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);
        xhr.send();
        xhr.onreadystatechange = () => {
          if (xhr.status == 200 && xhr.readyState == 4) {
            let [res] = JSON.parse(xhr.responseText);
            document.querySelector("._1a").innerHTML =
              res.pickup_address_1 == null ? "" : res.pickup_address_1;
            document.querySelector("._cn").innerHTML =
              res.pickup_address_1 == null
                ? ""
                : res.c_first_name + " " + res.c_last_name;
            document.querySelector("._cmz").innerHTML =
              res.pickup_address_1 == null ? "N/A" : res.zone;
            document.querySelector("._cmn").innerHTML =
              res.pickup_address_1 == null
                ? "Please, Click on Edit"
                : res.c_phone;
          }
        };
      }
      //address
      //checkout
      document.querySelector("._dm").addEventListener("submit", (e) => {
        e.preventDefault();
        let dm = new FormData(document.querySelector("._dm"));
        _dm.dm = dm.get("d-method");
        _dm.u = dm.get("d-u") || false;
        document.querySelector("._dm").style.display = "none";
        document.querySelector("._dm-r").style.display =
          document.querySelector("._dm").style.display == "none"
            ? "block"
            : "none";
        document.querySelector(
          "._dm-r"
        ).innerHTML = `<b>Delivery Method: </b>${_dm.dm}`;
        document.querySelector(".-s-i-2").style.color = "green";
        document.querySelector(".payment").style.display = "block";
      });
    </script>
    <script>
      _ua(`/api/user/account/address/${yammie}`);
      if (screen.availWidth <= 768) {
        document.querySelector("#logo").src = "../resources/cartlink.png";
        document.querySelector("#logo").style.width = "60px";
        document.querySelector("#logo").style.height = "30px";
      }
      //shipping
    </script>
    <script>
      function _od(i, c) {
        i.addEventListener("click", () => {
          c.classList.toggle("active");
          i.innerHTML =
            i.innerHTML == "Show Order Details"
              ? "Hide Order Details"
              : "Show Order Details";
        });
      }
      _od(
        document.querySelector(".show_order"),
        document.querySelector(".-od-ctr")
      );
    </script>
    <script>
      let _shp_r = {
        _add: localStorage.getItem("_upa")
          ? localStorage.getItem("_upa")
          : true,
        urgent: true,
      };
      let xhr_f = new XMLHttpRequest();
      xhr_f.open("POST", `/api/user/checkout/cart/${yammie}`, true);
      xhr_f.setRequestHeader("Content-type", "application/json");
      xhr_f.send(JSON.stringify(_shp_r));
      xhr_f.onreadystatechange = () => {
        if (xhr_f.readyState == 4 && xhr_f.status == 200) {
          let _order = JSON.parse(xhr_f.responseText);
          document.querySelector("._shp").innerHTML =
            "UGX " + numberFormat.format(_order.shipping);
          document.querySelector("._total").innerHTML =
            "UGX " + numberFormat.format(_order.total_price);
          document.querySelector("#delivery").innerHTML = numberFormat.format(
            _order.shipping
          );
          document.querySelector("#pay").innerHTML = numberFormat.format(
            _order.total_price
          );
          document.querySelector("._ony-tt").innerHTML =
            "UGX " + numberFormat.format(_order.shipping + _order.total_price);
          document.querySelector("#total").innerHTML = numberFormat.format(
            _order.shipping + _order.total_price
          );
          document.querySelector("._pf").addEventListener("submit", (e) => {
            e.preventDefault();
            document.querySelector(".-ony-ldr > i ").style.display = "inline";
            let pf = new FormData(document.querySelector("._pf"));
            pf.append("yammie", yammie);
            pf.append("_shp", _order.shipping);
            pf.append("_ttp", _order.total_price);
            pf.append("dm", _dm.dm);
            pf.append("u", _dm.u);
            pf.append("add", _add.add);
            pf.forEach((value, key) => {
              _ony[key] = value;
            });
            let _or = new XMLHttpRequest();
            _or.onreadystatechange = () => {
              if (_or.readyState == 4 && _or.status == 200) {
                localStorage.removeItem("cartItems");
                localStorage.removeItem("cartNumber");
                let res = JSON.parse(_or.responseText);
                if (res[0] == "mm") {
                  localStorage.setItem("_ym", `${res[2]}`);
                  window.location.assign(`../orders/finishup?order=${res[1]}`);
                } else {
                  window.location.assign(
                    `../orders/cashondelivery?order=${res[1]}`
                  );
                }
              }
            };
            _or.open("POST", `/api/user/customer/order/`, true);
            _or.setRequestHeader("Content-Type", "application/json");
            _or.send(JSON.stringify(_ony));
          });
        }
      };
    </script>
    <!--scripts-->
  </body>
</html>
