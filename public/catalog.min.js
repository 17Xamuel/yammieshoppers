function search(url) {
  xhr = new XMLHttpRequest();
  xhr.onreadystatechange = () => {
    if (xhr.readyState == 4 && xhr.status == 200) {
      let searchData = JSON.parse(xhr.responseText);
      if (searchData.length === 0) {
        let noData = `<div class="no-itms">
              <img
                src="./resources/undraw_blank_canvas_3rbb.svg"
                width="50%"
                height="50%"
                alt=""
              />
                <div style="text-align:center">
                  <span>
                    Sorry, Some Items Are Not Here.
                    <br/>
                  </span>
                  Try Making a request.
                  <br>
                  <a href="./support/request">
                    <button id="ctlg-rq-btn">Make A Request</button>
                  </a>
                </div>
            </div>`;
        document.getElementById("ctlg-ctr").innerHTML = noData;
        document.getElementById("ctlg-ctr").style.justifyContent = "center";
        document.getElementById("ctlg-ctr").style.justifyContent = "center";
      } else {
        let itmsSearched = "";
        searchData.forEach((itm) => {
          let _sp = JSON.parse(itm.specifications);
          itmsSearched += `
              <div class="-test -catalog itm-searched">
              <div class="a-s-discount">
                <span class="d">
                  ${
                    itm.discount !== null && itm.discount !== 0
                      ? "-" + itm.discount + "%"
                      : ""
                  }
                </span>
              </div>
              <a class="itm-s-img" href="./item?item=${itm.product_id}">
                <div class="_img-ctr">
                  <img
                    src="./resources/placeholder.png"
                    class="_ctg-image-load"
                    data-src="${JSON.parse(itm.images)[0]}"
                    alt="${itm.product}"
                    width="100%"
                    height="100%"
                  />
                </div>
              </a>
              <div class="itm-s-dtl">
                <div class="seller">
                  <b>Seller:</b> ${itm.businessname}
                </div>
                <a class="itm-name" style="font-size:13.5px;"
                  href="./item?item=${itm.product_id}">
                  ${itm.product} - ${itm.description}
                </a>
                <div class="price-current">${
                  "UGX " +
                  (itm.discount
                    ? new Intl.NumberFormat().format(
                        (itm.price * (100 - itm.discount)) / 100
                      )
                    : new Intl.NumberFormat().format(itm.price))
                }</div>
                <div class="price-prev">${
                  itm.discount ? "UGX " + itm.price : ""
                }</div>
                <div class="location" style="padding:5px 0px;">
                  <i class="fas fa-map-marker-alt"></i>
                  <span>${itm.location}</span>
                </div>
                <div class="delivery-by">
                  <i class="fab fa-telegram-plane"></i>
                  Yammie Delivery
                </div>
                <div class="a-t-c add-to-c"
                  data-item=${itm.product_id}
                  data-sp=${
                    Object.keys(_sp).find(
                      (elem) =>
                        typeof _sp[elem] == "object" && _sp[elem] != null
                    )
                      ? "true"
                      : "false"
                  }
                >
                  Add to Cart
                </div>
              </div>
            </div>`;
        });
        document.querySelectorAll(".d").forEach((item) => {
          if (item.innerText == "") item.style.display = "none";
        });
        document.getElementById("s-itms-ctr").innerHTML = itmsSearched;
        let btns = document.querySelectorAll(".add-to-c");
        if (screen.availWidth < 768) {
          btns.forEach((btn) => {
            btn.innerHTML = "Add To Cart";
          });
        }
        //for specifications;
        async function itemCollect(i) {
          try {
            let res = await fetch(`/api/user/product/${i}`);
            let item = await res.json();
            return item;
          } catch (error) {
            console.log("Error: ", error);
          }
        }

        btns.forEach((btn) => {
          btn.addEventListener("click", async (e) => {
            btn.innerText = "Adding...";
            if (e.target.dataset.sp == "true") {
              let _itm = await itemCollect(e.target.dataset.item);
              getVar(_itm.specifications, e.target.dataset.item);
            } else {
              console.log("_sp: ", e.target.dataset.sp);
              console.log("this: ", this);
              let cartItem = {
                cartItemAdded: e.target.dataset.item,
                inCartNumber: 0,
              };
              cartNumbers(cartItem);
              wait();
            }
          });
        });
        function wait() {
          let popUp = document.querySelector(".popup");
          let pContent = popUp.innerHTML;
          popUp.innerHTML = `
              <div>
              <div id="cartLoader"></div>
              <br />
              <div>Adding to Cart . . .
              </div>
              </div>`;
          setTimeout(() => {
            popUp.innerHTML = pContent;
          }, 1500);
        }
        function cartNumbers(item) {
          let cartNumber = parseInt(localStorage.getItem("cartNumber"));
          if (cartNumber) {
            localStorage.setItem("cartNumber", cartNumber + 1);
            document.querySelector("#cartNumberItems").textContent =
              cartNumber + 1;
          } else {
            localStorage.setItem("cartNumber", 1);
            document.querySelector("#cartNumberItems").textContent = 1;
          }
          setItem(item);
        }
        function setItem(item) {
          let cartItems = localStorage.getItem("cartItems");
          cartItems = JSON.parse(cartItems);
          if (cartItems != null) {
            if (cartItems[item.cartItemAdded] == undefined) {
              cartItems = {
                ...cartItems,
                [item.cartItemAdded]: item,
              };
            }
            cartItems[item.cartItemAdded].inCartNumber += 1;
          } else {
            item.inCartNumber = 1;
            cartItems = {
              [item.cartItemAdded]: item,
            };
          }
          if (!yammie) {
            localStorage.setItem("cartItems", JSON.stringify(cartItems));
          } else {
            _cdb(`/api/user/customer/cart/${yammie}`, {
              cart: cartItems,
              cartNumber: localStorage.getItem("cartNumber"),
              delete: false,
            });
          }

          document.querySelector("#pop-up-overlay").classList.add("active");
          document.querySelector(".popup").classList.add("pp-active");
        }
      }
      //lazy load
      let images = document.images;
      for (let i = 0; i < images.length; i++) {
        if (images[i].className == "_ctg-image-load") {
          _load(images[i], images[i].dataset.src);
        }
      }
      function _load(i, d) {
        let image_true = new Image();
        image_true.onload = function () {
          i.src = this.src;
        };
        image_true.src = d;
      }

      //variations
      // if(variations)
      function getVar(sp, _i) {
        let _sp = JSON.parse(sp);
        Object.keys(_sp).forEach((item) => {
          if (typeof _sp[item] == "object" && _sp[item] != null) {
            let _varDom = ` <div class="var_ctr">
                                  <h3 class="_var_heading">
                                    Please Select Your ${item}
                                  </h3>`;
            if (typeof _sp[item][0] == "string") {
              _sp[item].forEach((i) => {
                _varDom += `<div class="_var">
                                  <div class="var_name_chip">${i}</div>
                                  <div class="var_qty_ctr">
                                     <input type="radio" value="${i}"  name="${item}">
                                  </div>
                                </div>`;
              });
              document.querySelector(".var").innerHTML += _varDom + `</div>`;
            } else if (item == "Ingredients") {
              _sp[item].forEach((i) => {
                _varDom += `<div class="_var">
                                  <div class="var_name">${i.descriptions}</div>
                                  <div class="var_price">
                                    <div class="_n_price">
                                      UGX ${
                                        i.getDiscount <= 0
                                          ? i.getPrice
                                          : i.getPrice *
                                            ((100 - i.getDiscount) / 100)
                                      }
                                    </div>
                                    <div class="_d_price">${
                                      i.getDiscount <= 0 ? "" : i.getPrice
                                    }</div>
                                  </div>
                                  <div class="var_qty_ctr">
                                    <div class="var_minus ${i.descriptions}">
                                      &minus;
                                    </div>
                                    <input
                                      type="text"
                                      class="var_qty _increase"
                                      name="_${i.descriptions}"
                                      readonly
                                      value="${1}"
                                    />
                                    <div class="var_plus ${i.descriptions}">
                                      &plus;
                                    </div>
                                  </div>
                                </div>`;
              });

              document.querySelector(".var").innerHTML += _varDom + `</div>`;
            } else {
              _sp[item].forEach((i) => {
                _varDom += `<div class="_var">
                                  <div class="var_name">${i.descriptions}</div>
                                  <div class="var_price">
                                    <div class="_n_price">
                                      UGX ${
                                        i.getDiscount <= 0
                                          ? i.getPrice
                                          : i.getPrice *
                                            ((100 - i.getDiscount) / 100)
                                      }
                                    </div>
                                    <div class="_d_price">${
                                      i.getDiscount <= 0 ? "" : i.getPrice
                                    }</div>
                                  </div>
                                  <div class="var_qty_ctr">
                                    <input type="radio" value="${
                                      i.descriptions
                                    }" name="${item}">
                                  </div>
                                </div>`;
              });
              document.querySelector(".var").innerHTML += _varDom + `</div>`;
            }
          }
          if (
            Object.keys(_sp).findIndex((elem) => elem == item) ==
            Object.keys(_sp).length - 1
          ) {
            document.querySelector(".var").innerHTML += `
                <div class="" style="display: flex; justify-content: center; width:100%">
                  <button class="btn_variation">Add To Cart</button>
                </div>`;
          }
        });
        document.querySelector(".var").classList.add("var-active");
        document.querySelector("#pop-up-overlay-var").classList.add("v-active");

        document.querySelectorAll(".var_minus").forEach((item) => {
          item.addEventListener("click", (e) => {
            let _value = parseInt(
              document.querySelector(`input[name=_${e.target.classList[1]}]`)
                .value
            );
            let newValue = _value < 2 ? _value : _value - 1;
            document.querySelector(
              `input[name=_${e.target.classList[1]}]`
            ).value = newValue;
          });
        });
        document.querySelectorAll(".var_plus").forEach((item) => {
          item.addEventListener("click", (e) => {
            let _value = parseInt(
              document.querySelector(`input[name=_${e.target.classList[1]}]`)
                .value
            );
            let newValue = _value + 1;
            document.querySelector(
              `input[name=_${e.target.classList[1]}]`
            ).value = newValue;
          });
        });

        document.querySelector("#var_form").addEventListener("submit", (e) => {
          e.preventDefault();
          let _varForm = new FormData(document.querySelector("#var_form"));
          document.querySelector(".var").classList.remove("var-active");
          document
            .querySelector("#pop-up-overlay-var")
            .classList.remove("v-active");
          let specs = {};
          specs.Ingredients = {};
          _varForm.forEach((v, k) => {
            if (k.charAt(0) == "_") {
              specs.Ingredients[k.slice(1)] = v;
            } else {
              specs[k] = v;
            }
          });
          let cartItem = {
            cartItemAdded: _i,
            specs,
            inCartNumber: 0,
          };
          cartNumbers(cartItem);
          wait();
        });
      }
      //variations
    }
  };
  xhr.open("GET", url, true);
  xhr.send();
}
