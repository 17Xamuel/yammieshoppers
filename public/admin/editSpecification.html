<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="shortcut icon"
      href="../resources/cartlink.png"
      type="image/x-icon"
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0,shrink-to-fit=no"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha256-Ww++W3rXBfapN8SZitAvc9jw2Xb+Ixt0rvDsmWmQyTo="
      crossorigin="anonymous"
    />
    <script
      defer
      src="https://use.fontawesome.com/releases/v5.0.10/js/all.js"
      integrity="sha256-m5Awq0wGGRCO7AtN92mhhdGt+TJC70hTou7/t5M11WY="
      crossorigin="anonymous"
    ></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="./styles/home.css" />

    <title>Yammie | Product Specifications</title>
    <script>
      if (document.referrer == "") window.location.assign("./index");
    </script>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-md navbar-light">
      <button
        class="navbar-toggler ml-auto mb-2 bg-light"
        type="button"
        data-toggle="collapse"
        data-target="#myNavbar"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="myNavbar">
        <div class="container-fluid">
          <div class="row">
            <!-- Sidebar -->
            <div class="col-xl-2 col-lg-3 col-md-4 sidebar fixed-top">
              <a
                href="#"
                class="navbar-brand text-white d-block text-center py-3 mx-auto mb-4 border-bottom"
                >YammieShoppers</a
              >
              <div class="border-bottom pb-3">
                <a href="#" class="text-white">Hello <span id="user"></span></a>
              </div>
              <ul class="navbar-nav flex-column mt-4">
                <li class="nav-item">
                  <a href="home" class="nav-link text-white p-3 mb-2"
                    ><i class="fas fa-home text-light fa-lg mr-3"></i>Home</a
                  >
                </li>

                <li class="nav-item">
                  <a href="sales" class="nav-link text-white p-3 mb-2"
                    ><i class="fas fa-shopping-cart text-light fa-lg mr-3"></i
                    >Sales</a
                  >
                </li>

                <li class="nav-item current">
                  <a href="products" class="nav-link text-white p-3 mb-2"
                    ><i class="fas fa-wrench text-light fa-lg mr-3"></i
                    >Products</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    href="customers"
                    class="nav-link text-white p-3 mb-2 sidebar-link"
                    ><i class="fas fa-users text-light fa-lg mr-3"></i
                    >Customers</a
                  >
                </li>
                <li class="nav-item">
                  <a href="upload" class="nav-link text-white p-3 mb-2"
                    ><i class="fas fa-arrow-up text-light fa-lg mr-3"></i
                    >Uploads</a
                  >
                </li>
                <li class="nav-item">
                  <a href="profile" class="nav-link text-white p-3 mb-2"
                    ><i class="fas fa-user text-light fa-lg mr-3"></i>Profile</a
                  >
                </li>
              </ul>
            </div>

            <!-- End Sidebar -->

            <!-- Topnavbar -->
            <div
              class="col-xl-10 col-lg-9 col-md-8 bg-dark ml-auto fixed-top py-2 top-navbar"
            >
              <div class="row align-items">
                <div class="col-md-4 mb-0 text-light py-3 text-uppercase">
                  <h4>Dashboard</h4>
                </div>
                <div class="col-md-5"></div>
                <div class="col-md-3 py-2">
                  <ul class="navbar-nav">
                    <li class="list-item icon-parent">
                      <a href="#" class="nav-link"
                        ><span class="text-white icon-bullet">4</span
                        ><i class="fas fa-comments text-muted fa-2x"></i
                      ></a>
                    </li>
                    <li class="list-item icon-parent">
                      <a href="#" class="nav-link"
                        ><span class="text-white icon-bullet">5</span
                        ><i class="fas fa-bell text-muted fa-2x"></i
                      ></a>
                    </li>
                    <li class="list-item ml-md-auto">
                      <a
                        href="#"
                        class="nav-link"
                        data-target="#sign-out"
                        data-toggle="modal"
                        ><i class="fas fa-power-off text-danger fa-2x"></i
                      ></a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <!--End Topnavbar -->
          </div>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->

    <!-- Modal -->
    <div class="modal fade" id="sign-out">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Want to Leave?</h4>
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
          </div>
          <div class="modal-body">Press Logout to Leave</div>
          <div class="modal-footer">
            <button type="button" data-dismiss="modal" class="btn btn-success">
              Stay Here
            </button>
            <button type="button" id="alg" class="btn btn-danger">
              Log Out
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- End Modal -->

    <!-- Details -->
    <section>
      <div class="container-fluid">
        <div class="row">
          <div class="col-xl-10 col-lg-9 col-md-8 ml-auto">
            <div class="row pt-md-5 mt-md-3 align-items-center">
              <div class="col-xl-10 mx-auto my-5">
                <div class="card rounded">
                  <div class="card-body">
                    <h5 class="text-center text-info">
                      Edit Product Specifications
                    </h5>
                    <form id="editSpecifications">
                      <div class="form-row">
                        <div class="form-group col-md-6">
                          <label for="brand">Brand</label>
                          <input
                            type="text"
                            class="form-control"
                            id="brand"
                            placeholder="Brand"
                            autocomplete="off"
                            required
                          />
                        </div>
                        <div class="form-group col-md-6">
                          <label for="size">Size</label>
                          <input
                            type="text"
                            class="form-control"
                            id="size"
                            placeholder="Size"
                            autocomplete="off"
                            required
                          />
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-md-6">
                          <label for="weight">Weight</label>
                          <input
                            type="text"
                            class="form-control"
                            id="weight"
                            placeholder="Weight"
                            autocomplete="off"
                            required
                          />
                        </div>
                        <div class="form-group col-md-6">
                          <label for="netWeight">Net Weight</label>
                          <input
                            type="text"
                            class="form-control"
                            id="netWeight"
                            placeholder="Net Weight"
                            autocomplete="off"
                          />
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-md-6">
                          <label for="type">Type of Product</label>
                          <input
                            type="text"
                            class="form-control"
                            id="type"
                            placeholder="Type of Product"
                            autocomplete="off"
                            required
                          />
                        </div>
                        <div class="form-group col-md-6">
                          <label for="fragiltity">Fragile</label>
                          <input
                            type="text"
                            class="form-control"
                            id="fragility"
                            placeholder="Fragility"
                            autocomplete="off"
                            required
                          />
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="Dimensions">Dimensions</label>
                        <input
                          type="text"
                          class="form-control"
                          id="dimensions"
                          placeholder="Dimensions"
                        />
                      </div>

                      <ul class="list-group">
                        <li class="list-group-item">
                          <ul class="list-group">
                            <li class="list-group-item">Colors</li>
                            <li class="list-group-item">
                              <button
                                type="button"
                                class="btn btn-primary btn-sm"
                                id="color"
                              >
                                Add More
                              </button>
                            </li>
                          </ul>
                          <div class="form-group newColor" id="myColors"></div>
                        </li>
                        <li class="list-group-item">
                          <ul class="list-group">
                            <li class="list-group-item">Flavors</li>
                            <li class="list-group-item">
                              <button
                                type="button"
                                class="btn btn-info btn-sm"
                                id="Flavour"
                              >
                                Add More
                              </button>
                            </li>
                          </ul>
                          <div
                            class="form-group newFlavour"
                            id="myflavors"
                          ></div>
                        </li>
                        <li class="list-group-item">
                          <ul class="list-group">
                            <li class="list-group-item">My Sizes</li>
                            <li class="list-group-item">
                              <button
                                type="button"
                                class="btn btn-success btn-sm"
                                id="sizing"
                              >
                                Add More
                              </button>
                            </li>
                          </ul>

                          <div class="form-row" id="si"></div>
                          <div class="text-center newSize"></div>
                        </li>
                        <li class="list-group-item">
                          <ul class="list-group">
                            <li class="list-group-item">Ingredient</li>
                            <li class="list-group-item">
                              <button
                                type="button"
                                class="btn btn-danger btn-sm"
                                id="Ingridient"
                              >
                                Add More
                              </button>
                            </li>
                          </ul>

                          <div class="form-row" id="ing"></div>
                          <div class="text-center newIngridients"></div>
                        </li>
                      </ul>

                      <button
                        type="submit"
                        class="btn btn-warning btn-block text-light my-3"
                      >
                        Update
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- End details -->

    <!-- Footer -->
    <footer>
      <div class="container-fluid">
        <div class="row">
          <div class="col-xl-10 col-lg-9 col-md-8 ml-auto">
            <div class="row border-top pt-3">
              <div class="col-lg-6 text-center">
                <ul class="list-inline">
                  <li class="list-inline-item mr-2">
                    <a href="#" class="text-dark">YammieShoppers</a>
                  </li>
                  <li class="list-inline-item mr-2">
                    <a href="#" class="text-dark">About</a>
                  </li>
                  <li class="list-inline-item mr-2">
                    <a href="#" class="text-dark">Support</a>
                  </li>
                  <li class="list-inline-item mr-2">
                    <a href="#" class="text-dark">Blog</a>
                  </li>
                </ul>
              </div>
              <div class="col-lg-6 text-center">
                <p>
                  &copy; <span id="year"></span> Copy Right Made With
                  <i class="fas fa-heart text-danger"></i>by
                  <span class="text-success">YammieShoppers</span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- End Footer -->

    <!-- Scripts -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src=" https://stackpath.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>

    <script src="scripts/account.js"></script>
    <script>
      const specification = new URLSearchParams(window.location.search).get(
        "specifications"
      );
      const specifications = new XMLHttpRequest();
      specifications.onreadystatechange = () => {
        if (specifications.readyState == 4 && specifications.status == 200) {
          let [outcome] = JSON.parse(specifications.responseText);
          let specify = JSON.parse(outcome.specifications);
          document.getElementById("brand").value = specify.Brand;
          document.getElementById("size").value = specify.Size;
          document.getElementById("weight").value = specify.Weight;
          document.getElementById("netWeight").value = specify.NetWeight;
          document.getElementById("type").value = specify.TypeOfProduct;
          document.getElementById("fragility").value = specify.Fragile;
          document.getElementById("dimensions").value = specify.Dimensions;
          if (specify.Color !== null) {
            let colorString = "";
            specify.Color.forEach((col) => {
              colorString += `        <input
                          type="text"
                          class="form-control color my-3"
                          placeholder="Color"
                          value="${col.replace(/_/g, " ")}"
                        >`;
            });
            document.getElementById("myColors").innerHTML = colorString;
          } else {
            document.getElementById("myColors").innerHTML =
              "No color was specified";
          }

          if (specify.Flavor !== null) {
            let flavorString = "";
            specify.Flavor.forEach((flav) => {
              flavorString += `        <input
                          type="text"
                          class="form-control flavor my-2"
                          placeholder="Flavour"
                          value="${flav.replace(/_/g, " ")}"
                        >`;
            });
            document.getElementById("myflavors").innerHTML = flavorString;
          } else {
            document.getElementById("myflavors").innerHTML =
              "No Flavor was specified";
          }

          function varrySize(obj, i) {
            i.innerHTML += `<div class="form-group col-md-4">
                         <input class="form-control my-2 sizes" type="text"
                         placeholder="Size" value="${obj.descriptions.replace(
                           /_/g,
                           " "
                         )}">
                        </div>
                        <div class="form-group col-md-4">
                          <input class="form-control my-2 sizePrice mynum" type="number"
                          placeholder="Size Price(UGX)" value="${obj.getPrice}">
                        </div>
                        <div class="form-group col-md-4">
                          <input class="form-control my-2 sizeDiscount mynum" type="number"
                          placeholder="Discount(%)" value="${obj.getDiscount}">
                        </div>`;
          }
          if (specify.Sizes !== null) {
            for (let j = 0; j < specify.Sizes.length; j++) {
              varrySize(specify.Sizes[j], document.querySelector("#si"));
            }
          } else {
            document.querySelector("#si").innerHTML = "No Sizes Found";
          }

          function varryIngridient(obj, i) {
            i.innerHTML += `<div class="form-group col-md-4">
                         <input class="form-control my-2 ingridients" type="text"
                         placeholder="Size" value="${obj.descriptions.replace(
                           /_/g,
                           " "
                         )}">
                        </div>
                        <div class="form-group col-md-4">
                          <input class="form-control my-2 ingridientPrice mynum" type="number"
                          placeholder="Size Price(UGX)" value="${obj.getPrice}">
                        </div>
                        <div class="form-group col-md-4">
                          <input class="form-control my-2 ingridientDiscount mynum" type="number"
                          placeholder="Discount(%)" value="${obj.getDiscount}">
                        </div>`;
          }
          if (specify.Ingredients !== null) {
            for (let i = 0; i < specify.Ingredients.length; i++) {
              varryIngridient(
                specify.Ingredients[i],
                document.querySelector("#ing")
              );
            }
          } else {
            document.querySelector("#ing").innerHTML = "No ingredients Found";
          }
        }
      };
      specifications.open(
        "GET",
        `/api/admin/getSpecifications/${specification}`,
        true
      );
      specifications.send();

      const myColor = document.querySelector(".newColor");
      document.getElementById("color").addEventListener("click", (e) => {
        let inner = document.createElement("div");
        inner.classList.add("form-group");
        let input0 = document.createElement("input");
        input0.classList.add("form-control", "color", "my-2");
        input0.setAttribute("type", "text");
        input0.setAttribute("Placeholder", "Color");
        inner.appendChild(input0);
        myColor.appendChild(inner);
      });

      const myFlavor = document.querySelector(".newFlavour");
      document.getElementById("Flavour").addEventListener("click", (e) => {
        let inner = document.createElement("div");
        inner.classList.add("form-group");
        let input0 = document.createElement("input");
        input0.classList.add("form-control", "flavor", "my-2");
        input0.setAttribute("type", "text");
        input0.setAttribute("Placeholder", "Flavor");
        inner.appendChild(input0);
        myFlavor.appendChild(inner);
      });

      const mySize = document.querySelector(".newSize");
      document.getElementById("sizing").addEventListener("click", (e) => {
        let main = document.createElement("div");
        main.classList.add("form-row");
        let innerdiv = document.createElement("div");
        innerdiv.classList.add("form-group", "col-md-4");
        let input1 = document.createElement("input");
        input1.classList.add("form-control", "sizes");
        input1.setAttribute("placeholder", "Size");
        input1.setAttribute("type", "text");
        innerdiv.appendChild(input1);
        let indiv = document.createElement("div");
        indiv.classList.add("form-group", "col-md-4");
        let input2 = document.createElement("input");
        input2.classList.add("form-control", "mynum", "sizePrice");
        input2.setAttribute("placeholder", "Size Price(UGX)");
        input2.setAttribute("type", "number");
        indiv.appendChild(input2);
        let lastdiv = document.createElement("div");
        lastdiv.classList.add("form-group", "col-md-4");
        let input3 = document.createElement("input");
        input3.classList.add("form-control", "mynum", "sizeDiscount");
        input3.setAttribute("placeholder", "Size Discount");
        input3.setAttribute("type", "number");
        lastdiv.appendChild(input3);
        main.append(innerdiv, indiv, lastdiv);
        mySize.appendChild(main);
      });

      const myIngridient = document.querySelector(".newIngridients");
      document.getElementById("Ingridient").addEventListener("click", (e) => {
        let main = document.createElement("div");
        main.classList.add("form-row");
        let innerdiv = document.createElement("div");
        innerdiv.classList.add("form-group", "col-md-4");
        let input1 = document.createElement("input");
        input1.classList.add("form-control", "ingridients");
        input1.setAttribute("placeholder", "Ingredients");
        input1.setAttribute("type", "text");
        innerdiv.appendChild(input1);
        let indiv = document.createElement("div");
        indiv.classList.add("form-group", "col-md-4");
        let input2 = document.createElement("input");
        input2.classList.add("form-control", "mynum", "ingridientPrice");
        input2.setAttribute("placeholder", "Price(UGX)");
        input2.setAttribute("type", "number");
        indiv.appendChild(input2);
        let lastdiv = document.createElement("div");
        lastdiv.classList.add("form-group", "col-md-4");
        let input3 = document.createElement("input");
        input3.classList.add("form-control", "mynum", "ingridientDiscount");
        input3.setAttribute("placeholder", "Discount");
        input3.setAttribute("type", "number");
        lastdiv.appendChild(input3);
        main.append(innerdiv, indiv, lastdiv);
        myIngridient.appendChild(main);
      });

      let prevent = document.querySelectorAll(".mynum");
      prevent.forEach((input) => {
        input.addEventListener("keydown", (e) => {
          if (e.which === 69) {
            e.preventDefault();
          }
        });
      });

      document
        .getElementById("editSpecifications")
        .addEventListener("submit", (e) => {
          e.preventDefault();
          let newSpecifications = {};

          let newColors = [];
          let newC = document.querySelectorAll(".color");
          newC.forEach((color) => {
            if (color.value.length != 0) {
              newColors.push(color.value.replace(/ /g, "_"));
            }
          });

          let newFlavours = [];
          let newF = document.querySelectorAll(".flavor");
          newF.forEach((flavor) => {
            if (flavor.value.length != 0) {
              newFlavours.push(flavor.value.replace(/ /g, "_"));
            }
          });

          function getVariations(mydescription, pricing, discounting) {
            if (
              mydescription !== null &&
              pricing !== null &&
              discounting !== null
            ) {
              let myVariations = [];
              for (let j = 0; j < mydescription.length; j++) {
                myVariations.push({
                  descriptions: mydescription[j],
                  getPrice: pricing[j],
                  getDiscount: discounting[j],
                });
              }
              return myVariations;
            } else {
              return null;
            }
          }

          let newSizes = [];
          let newS = document.querySelectorAll(".sizes");
          newS.forEach((size) => {
            if (size.value.length != 0) {
              newSizes.push(size.value.replace(/ /g, "_"));
            }
          });

          let newSizePrices = [];
          let newSp = document.querySelectorAll(".sizePrice");
          newSp.forEach((sprice) => {
            if (sprice.value.length != 0) {
              newSizePrices.push(parseInt(sprice.value));
            }
          });

          let newSizeDiscounts = [];
          let newSd = document.querySelectorAll(".sizeDiscount");
          newSd.forEach((sdis) => {
            if (sdis.value.length != 0) {
              newSizeDiscounts.push(parseInt(sdis.value));
            }
          });

          let newIngridientsEdit = [];
          let newI = document.querySelectorAll(".ingridients");
          newI.forEach((ingr) => {
            if (ingr.value.length != 0) {
              newIngridientsEdit.push(ingr.value.replace(/ /g, "_"));
            }
          });

          let newIngridientsPrices = [];
          let newIp = document.querySelectorAll(".ingridientPrice");
          newIp.forEach((ip) => {
            if (ip.value.length != 0) {
              newIngridientsPrices.push(parseInt(ip.value));
            }
          });

          let newIngridientDiscounts = [];
          let newId = document.querySelectorAll(".ingridientDiscount");
          newId.forEach((id) => {
            if (id.value.length !== 0) {
              newIngridientDiscounts.push(parseInt(id.value));
            }
          });

          newSpecifications.newBrand = document.getElementById("brand").value;
          newSpecifications.newSize = document.getElementById("size").value;
          newSpecifications.newWeight = document.getElementById("weight").value;
          newSpecifications.NetWeight = document.getElementById(
            "netWeight"
          ).value;
          newSpecifications.typeOfProduct = document.getElementById(
            "type"
          ).value;
          newSpecifications.Fragile = document.getElementById(
            "fragility"
          ).value;
          newSpecifications.Dimensions =
            document.getElementById("dimensions").value || null;

          newColors.length > 0 ? (newSpecifications.color = newColors) : null;
          newFlavours.length > 0
            ? (newSpecifications.flavor = newFlavours)
            : null;
          newSizes.length > 0
            ? (newSpecifications.sizes = getVariations(
                newSizes,
                newSizePrices,
                newSizeDiscounts
              ))
            : null;
          newIngridientsEdit.length > 0
            ? (newSpecifications.ingridients = getVariations(
                newIngridientsEdit,
                newIngridientsPrices,
                newIngridientDiscounts
              ))
            : null;

          let data = new XMLHttpRequest();
          data.onreadystatechange = function () {
            if (data.readyState == 4 && data.status == 200) {
              if (data.responseText == "OK") {
                window.location.assign("products");
              }
            }
          };
          data.open(
            "POST",
            `/api/admin/editSpecifications/${specification}`,
            true
          );
          data.setRequestHeader("Content-Type", "application/json");
          data.send(JSON.stringify(newSpecifications));
        });
    </script>
    <!-- End Scripts -->
  </body>
</html>
